# US 32 - To create a category

## 1. Requirements Engineering

### 1.1. User Story Description

As a Person (Registered User), I want to create a new category.

### 1.2. Customer Specifications and Clarifications 

**From the specifications document:**

> By simplicity, a category just comprehends a unique alphanumeric code and a brief description.

**From the client clarifications:**

> **Question:** ?
>
> **Answer:** *

### 1.3. Acceptance Criteria

- AC01-1: The category code cannot be empty or have less than five characters.
- AC01-2: The category description cannot be empty.

### 1.4. Found out Dependencies

- No dependencies were found.

### 1.5 Input and Output Data

**Input Data:**

- Typed data:
    - a code
    - a description

- Selected data:
    - n/a

**Output Data:**

- (In)success of the operation

### 1.6. System Sequence Diagram (SSD)

![US01-SSD](US01-SSD.svg)

### 1.7 Other Relevant Remarks

- The created category is ready to be used in task categorization.


## 2. OO Analysis

### 2.1. Relevant Domain Model Excerpt 

![US01-MD](US01-MD.svg)

### 2.2. Other Remarks

- n/a

## 3. Design - User Story Realization 

### 3.1. Rationale

- n/a

### Systematization

According to the taken rationale, the conceptual classes promoted to software classes are: 

- Person
- Category

Other software classes (i.e. Pure Fabrication) identified:

- CreateCategoryView
- CreateCategoryController
- CategoryService
- CategoryRepository
- RepositoryFactory

### 3.2. Sequence Diagram (SD)

### 3.2.1. Previous Perspective (using Controllers for a Console UI) 

**On this matter, Sprint 3 add no changes here.**

![US01-SD-v2](US01-SD-v2.svg)

**Notice that:**

- According to the Repository and Service patterns, the CategoryContainer was split in two classes: CategoryRepository and CategoryService, respectively.
- The RepositoryFactory class is the result of applying the Abstract Factory pattern to ensure that the "{XXX}Repository" classes used are all from the same family of objects (i.e., they use the same persistence mechanism).
- No DTO was used, but it could have been.

### 3.2.2. REST API Perspective (reusing the domain logic)

**To accommodate the Sprint 3 requirements.**

![US01-SD-RestAPI](US01-SD-RestAPI.svg)

**This SD is in conformity with the Generic Flow in Any HTTP Request defined [here](../HTTPFlow/HTTPFlow.md).**

**For brevity, sequence diagrams can be simplified to denote just what happens on the respective Controller.**

![US01-SD-RestAPI-Simplified](US01-SD-RestAPI-Simplified.svg)

**Comparing the Sequence Diagrams presented, observe to what extent (100%?) the domain logic was reused without any changes.**

### 3.3. Class Diagram (CD)

### 3.3.1. Previous Perspective (using Controllers for a Console UI)

Class diagram as resulting from the above sequence diagram and rationale:

![US01-CD](US01-CD.svg)

Adding to the previous class diagram the classes currently implementing the adopted interfaces.
Notice that the sequence diagram does not state which concrete implementation is being used since it may vary by configurations (cf. "config.ini" file). 

![US01-CD_v2](US01-CD_v2.svg)

### 3.3.2. REST API Perspective (reusing the domain logic)

**To accommodate the Sprint 3 requirements.**

Just the new classes are shown.

![US01-CD-RestAPI](US01-CD-RestAPI.svg)


## 4. Tests

Three relevant test scenarios are highlighted next.
Other test were also specified.

**Test 1:** Check that it is not possible to create an instance of the Category class with invalid values. 

      TEST_F(CategoryFixture, CreateWithEmptyCode){
          EXPECT_THROW(new Category(L"",L"Category One"),std::invalid_argument);
      }

      TEST_F(CategoryFixture, CreateWithCodeHavingFourChars){
          EXPECT_THROW(new Category(L"C001",L"Category One"),std::invalid_argument);
      }

**Test 2:** Check that it is possible to create an instance of the Category class with valid values.

      TEST_F(CategoryFixture, CreateWithValidData){
          EXPECT_NO_THROW(new Category(L"C0001",L"Category One"));
      }

**Test 3:** Check that it is possible create and add/save a category on the CategoryMemoryRepository.
    
      TEST_F(CategoryMemoryRepositoryFixture, AddingOneCategory){
          EXPECT_TRUE(this->repo->isEmpty());
          shared_ptr<Category> cat = make_shared<Category>(L"C0019", L"Category 19");
          this->repo->save(cat);
          EXPECT_FALSE(this->repo->isEmpty());
      }
    

## 5. Integration and Demo 

A menu option on the console application was added. Such option invokes the CreateCategoryView.

      int CategoriesMenuView::processMenuOption(int option) {
          int result = 0;
          BaseView * view;
          switch (option) {
          
            case 1:
              view = new CreateCategoryView(this->userToken);
              view->show();
              break;
            ...
          }
          return result;
      }
      

## 6. Observations

n/a